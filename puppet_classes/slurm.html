<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>
  Puppet Class: slurm
  
    &mdash; Documentation by YARD 0.9.26
  
</title>

  <link rel="stylesheet" href="../css/style.css" type="text/css" />

  <link rel="stylesheet" href="../css/common.css" type="text/css" />

<script type="text/javascript">
  pathId = "puppet_classes::slurm";
  relpath = '../';
</script>


  <script type="text/javascript" charset="utf-8" src="../js/jquery.js"></script>

  <script type="text/javascript" charset="utf-8" src="../js/app.js"></script>


  </head>
  <body>
    <div class="nav_wrap">
      <iframe id="nav" src="../puppet_class_list.html?1"></iframe>
      <div id="resizer"></div>
    </div>

    <div id="main" tabindex="-1">
      <div id="header">
        <div id="menu">
  
    <a href="../_index.html">Index (s)</a> &raquo;
    <span class='title'><span class='object_link'>Puppet Classes</span></span>
     &raquo; 
    <span class="title">slurm</span>
  
</div>

        <div id="search">
  
    <a class="full_list_link" id="puppet_class_list_link"
        href="../puppet_class_list.html">

        <svg width="24" height="24">
          <rect x="0" y="4" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="12" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="20" width="24" height="4" rx="1" ry="1"></rect>
        </svg>
    </a>
  
</div>
        <div class="clear"></div>
      </div>

      <div id="content"><h1>Puppet Class: slurm</h1>
<div class="box_info">
  
  
  <dl>
    <dt>Defined in:</dt>
    <dd>
      manifests/init.pp
    </dd>
  </dl>
</div>

  <h2>Summary</h2>
  Main class that manages every aspect centrally

<h2>Overview</h2>
<div class="docstring">
  <div class="discussion">
    
<p>This module currently orchestrates every installation aspect. However it does not configure Slurm in terms of contents in /etc/slurm (slurm.conf# gres.conf, â€¦). These aspects have to be handled elsewhere, i.e. in a separate git repository.</p>

<p>Currently the module manages: * Installation of RPMs for the selected features * Creation of user and group slurm * Manage files, directories and services accoridng to the selected features</p>

<p>Features supported include: * client: only slurm commands, no additional services running * slurmd: slurm daemom is installed and started * slurmdbd: slurm database daemon is installed and started * slurmctld: slurm control daemon is installed and started</p>

<p>Features can be added up on the same node!</p>

<p>Note on config: Just store contents of <code>/etc/slurm</code> in a git repo and clone it on your shared filesystem to the final path using <code>puppetlabs-vcsrepo</code>.</p>

<p>}</p>

<p>Slurm user and group management related options</p>

  </div>
</div>


<div class="tags">
  
  <div class="examples">
    <p class="tag_title">Examples:</p>
    
      
        <p class="example_title"><div class='inline'>
<p>Basic setup of a compute node with memlock set to unlimited and increased number of open files</p>
</div></p>
      
      <pre class="example code"><code>class { &#39;slurm&#39;:
  slurmd                =&gt; true,
  slurmd_service_limits =&gt; {
    &#39;LimitMEMLOCK&#39; =&gt; &#39;infinity&#39;,
    &#39;LimitNOFILE&#39;  =&gt; 8192,
  },
  manage_firewall       =&gt; true,</code></pre>
    
      
        <p class="example_title"><div class='inline'>
<p>Setup of a slurm master with slurmctld and slurmdbd on the same host; reloading services is prevented</p>
</div></p>
      
      <pre class="example code"><code>class { &#39;slurm&#39;:
  slurmdbd        =&gt; true,
  slurmctld       =&gt; true,
  reload_services =&gt; false,
}</code></pre>
    
  </div>
<p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>client</span>
      
      
        <span class='type'>(<tt>Optional[Boolean]</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>The feature only installs the basic commands; no daemons get deployed; defaults s true</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>slurmd</span>
      
      
        <span class='type'>(<tt>Optional[Boolean]</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>The feature installis the slurm daemon, useful on a compute node; default is false</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>slurmdbd</span>
      
      
        <span class='type'>(<tt>Optional[Boolean]</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>This feature installs the slurm database daemon to talk to a MySQL database server: default is false</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>slurmctld</span>
      
      
        <span class='type'>(<tt>Optional[Boolean]</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>This feature installs the slurm control daemon: default is false</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>package_ensure</span>
      
      
        <span class='type'>(<tt>Optional[String]</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>The defeault package ensure is set to &#39;present&#39;; use other values if needed</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>manage_slurm_user</span>
      
      
        <span class='type'>(<tt>Optional[Boolean]</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>Should the module deploy user and gropu to be used for slurm aspects; defaults to true</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>slurm_user</span>
      
      
        <span class='type'>(<tt>Optional[String]</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>The username to use for ownerships of files/directories and services; default is &#39;slurm&#39;</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>slurm_user_uid</span>
      
      
        <span class='type'>(<tt>Optional[Integer]</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>The numeric id for the slurm user; default is 468</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>slurm_group</span>
      
      
        <span class='type'>(<tt>Optional[String]</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>The group name to use for ownerships of files/directories and services; default is &#39;slurm&#39;</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>slurm_group_gid</span>
      
      
        <span class='type'>(<tt>Optional[Integer]</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>The numeric id for the slurm group; default is 468</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>reload_services</span>
      
      
        <span class='type'>(<tt>Optional[Boolean]</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>If changes to configuration files occur, should a relaod of the services be done automatically? Default is true</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>restart_services</span>
      
      
        <span class='type'>(<tt>Optional[Boolean]</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>If changes to configuration files occur, should a restart of the services be done automatically; default is false</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>slurmd_service_ensure</span>
      
      
        <span class='type'>(<tt>Optional[String]</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>The defualt state of the slurm daemon; default is &#39;running&#39;</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>slurmd_service_enable</span>
      
      
        <span class='type'>(<tt>Optional[Boolean]</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>Should the slurm daemon be enabled by systemd; default is true</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>slurmd_service_limits</span>
      
      
        <span class='type'>(<tt>Optional[Hash]</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>A hash of system resource limits for the slurm daemon, see example; default is empty hash</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>slurmdbd_service_ensure</span>
      
      
        <span class='type'>(<tt>Optional[String]</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>The defualt state of the slurm database daemon; default is &#39;running&#39;</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>slurmdbd_service_enable</span>
      
      
        <span class='type'>(<tt>Optional[Boolean]</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>Should the slurm database daemon be enabled by systemd; default is true</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>slurmdbd_service_limits</span>
      
      
        <span class='type'>(<tt>Optional[Hash]</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>A hash of system resource limits for the slurm database daemon, see example; default is empty hash</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>slurmctld_service_ensure</span>
      
      
        <span class='type'>(<tt>Optional[String]</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>The defualt state of the slurm control daemon; default is &#39;running&#39;</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>slurmctld_service_enable</span>
      
      
        <span class='type'>(<tt>Optional[Boolean]</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>Should the slurm control daemon be enabled by systemd; default is true</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>slurmctld_service_limits</span>
      
      
        <span class='type'>(<tt>Optional[Hash]</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>A hash of system resource limits for the slurm control daemon, see example; default is empty hash</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>manage_logrotate</span>
      
      
        <span class='type'>(<tt>Optional[Boolean]</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>Should the module manage the logrotaiton of slurm logs; default is true</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>manage_firewall</span>
      
      
        <span class='type'>(<tt>Optional[Boolean]</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>Should the module configure the firewall rules for installed services; default is false</p>
</div>
      
    </li>
  
</ul>



</div><div class="method_details_list">
  <table class="source_code">
    <tr>
      <td>
        <pre class="lines">


89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197
198
199
200
201</pre>
      </td>
      <td>
        <pre class="code"><span class="info file"># File 'manifests/init.pp', line 89</span>

class slurm (
  Optional[Boolean] $client,
  Optional[Boolean] $slurmd,
  Optional[Boolean] $slurmdbd,
  Optional[Boolean] $slurmctld,
  Optional[String]  $package_ensure,
  # Slurm user and group management related options
  Optional[Boolean] $manage_slurm_user,
  Optional[String]  $slurm_user,
  Optional[Integer] $slurm_user_uid,
  Optional[String]  $slurm_group,
  Optional[Integer] $slurm_group_gid,
  # Services related options
  Optional[Boolean] $reload_services,
  Optional[Boolean] $restart_services,
  Optional[String]  $slurmd_service_ensure,
  Optional[Boolean] $slurmd_service_enable,
  Optional[Hash]    $slurmd_service_limits,
  Optional[String]  $slurmdbd_service_ensure,
  Optional[Boolean] $slurmdbd_service_enable,
  Optional[Hash]    $slurmdbd_service_limits,
  Optional[String]  $slurmctld_service_ensure,
  Optional[Boolean] $slurmctld_service_enable,
  Optional[Hash]    $slurmctld_service_limits,
  # Other options
  Optional[Boolean] $manage_logrotate,
  Optional[Boolean] $manage_firewall,
) {

  $osfamily = fact(&#39;os.family&#39;)
  $osmajor = fact(&#39;os.release.major&#39;)
  $os = &quot;${osfamily}-${osmajor}&quot;
  $supported = [&#39;RedHat-7&#39;,&#39;RedHat-8&#39;]
  if ! ($os in $supported) {
    fail(&quot;Unsupported OS: ${os}, module ${module_name} only supports RedHat 7 and 8&quot;)
  }

  ### Hardcoded options currently not overridable ###
  # Slurm user and group management related options
  $slurm_user_shell              = &#39;/sbin/nologin&#39;
  $slurm_user_home               = &#39;/var/lib/slurm&#39;
  $slurm_user_managehome         = true
  $slurm_user_comment            = &#39;SLURM User&#39;
  # Managed directories
  $conf_dir                      = &#39;/etc/slurm&#39;
  $log_dir                       = &#39;/var/log/slurm&#39;
  $slurmd_spool_dir              = &#39;/var/spool/slurmd.spool&#39;
  $slurmdbd_archive_dir          = &#39;/var/lib/slurmdbd.archive&#39;
  $slurmctld_state_save_location = &#39;/var/spool/slurmctld.state&#39;
  $slurmctld_job_checkpoint_dir  = &#39;/var/spool/slurmctld.checkpoint&#39;
  # Network ports of daemons
  $slurmctld_port                = 6817
  $slurmd_port                   = 6818
  $slurmdbd_port                 = 6819
  # Additional daemon cli arguments
  $slurmctld_options             = &#39;&#39;
  $slurmd_options                = &#39;&#39;
  $slurmdbd_options              = &#39;&#39;
  # Configuration files
  $slurm_conf_path               = &quot;${conf_dir}/slurm.conf&quot;
  $topology_conf_path            = &quot;${conf_dir}/topology.conf&quot;
  $gres_conf_path                = &quot;${conf_dir}/gres.conf&quot;
  $slurmdbd_conf_path            = &quot;${conf_dir}/slurmdbd.conf&quot;
  $cgroup_conf_path              = &quot;${conf_dir}/cgroup.conf&quot;

  # Compute which resources are to be notified and how to notify these on changes
  if $slurmd and $slurmd_service_ensure == &#39;running&#39; and $reload_services and $facts[&#39;slurmd_version&#39;] {
    $slurmd_notify = Exec[&#39;slurmd reload&#39;]
  } elsif $slurmd and $slurmd_service_ensure == &#39;running&#39; and $restart_services {
    $slurmd_notify = Service[&#39;slurmd&#39;]
  } else {
    $slurmd_notify = undef
  }

  if $slurmctld and $slurmctld_service_ensure == &#39;running&#39; and $reload_services and $facts[&#39;slurmctld_version&#39;] {
    $slurmctld_notify = Exec[&#39;scontrol reconfig&#39;]
  } elsif $slurmctld and $slurmctld_service_ensure == &#39;running&#39; and $restart_services {
    $slurmctld_notify = Service[&#39;slurmctld&#39;]
  } else {
    $slurmctld_notify = undef
  }

  if $slurmdbd and $slurmdbd_service_ensure == &#39;running&#39; and $reload_services and $facts[&#39;slurmdbd_version&#39;] {
    $slurmdbd_notify = Exec[&#39;slurmdbd reload&#39;]
  } elsif $slurmdbd and $slurmdbd_service_ensure == &#39;running&#39; and $restart_services {
    $slurmdbd_notify = Service[&#39;slurmdbd&#39;]
  } else {
    $slurmdbd_notify = undef
  }

  # in addition combine the ones not undef to an array for later use in slurm::common::install
  $service_notify = flatten([$slurmd_notify, $slurmctld_notify, $slurmdbd_notify]).filter |$val| { $val =~ NotUndef }

  if ! ($client or $slurmd or $slurmdbd or $slurmctld) {
    fail(&#39;No slurm feature has been selected. Select at least one of client, slurmd, slurmctld or slurmdbd.&#39;)
  }

  if $client {
    contain slurm::client
  }

  if $slurmd {
    contain slurm::slurmd
  }

  if $slurmdbd {
    contain slurm::slurmdbd
  }

  if $slurmctld {
    contain slurm::slurmctld
  }
}</pre>
      </td>
    </tr>
  </table>
</div>
</div>

      <div id="footer">
     Generated by <a href="http://yardoc.org" title="Yay! A Ruby Documentation Tool" target="_parent">yard</a>.
</div>

    </div>
  </body>
</html>